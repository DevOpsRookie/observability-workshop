<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="This workshop is going to take you through the exciting journey of App Dev, what this is, why this is important, and how to get started right away!"><link href=https://signalfx.github.io/app-dev-workshop/module3/k3s/ rel=canonical><meta name=author content="Sales Engineering"><link rel="shortcut icon" href=../../images/favicon.ico><meta name=generator content="mkdocs-1.1, mkdocs-material-5.1.1"><title>Deploying the Smart Agent in Kubernetes (K3s) - Splunk App Dev Workshop</title><link rel=stylesheet href=../../assets/stylesheets/main.a676eddb.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.b302131d.min.css><meta name=theme-color content><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style><link rel=stylesheet href=../../extra.css></head> <body dir=ltr data-md-color-primary=black data-md-color-accent> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#lab-summary class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=https://signalfx.github.io/app-dev-workshop/ title="Splunk App Dev Workshop" class="md-header-nav__button md-logo" aria-label="Splunk App Dev Workshop"> <img src=../../images/logo.png alt=logo> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z /></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> Splunk App Dev Workshop </span> <span class="md-header-nav__topic md-ellipsis"> Deploying the Smart Agent in Kubernetes (K3s) </span> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z /></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Type to start searching </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header-nav__source> <a href=https://github.com/signalfx/app-dev-workshop/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://signalfx.github.io/app-dev-workshop/ title="Splunk App Dev Workshop" class="md-nav__button md-logo" aria-label="Splunk App Dev Workshop"> <img src=../../images/logo.png alt=logo> </a> Splunk App Dev Workshop </label> <div class=md-nav__source> <a href=https://github.com/signalfx/app-dev-workshop/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> GitHub </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title=Home class=md-nav__link> <b>Home</b> </a> </li> <li class=md-nav__item> <a href=../../introduction/ title=Introduction class=md-nav__link> <b>Introduction</b> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> <b>Module 1</b> - Dashboards <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label="<b>Module 1</b> - Dashboards" data-md-level=1> <label class=md-nav__title for=nav-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> <b>Module 1</b> - Dashboards </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../module1/dashboards/ title="Working with Dashboards, Charts and Metrics" class=md-nav__link> Working with Dashboards, Charts and Metrics </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-4 type=checkbox id=nav-4> <label class=md-nav__link for=nav-4> <b>Module 2</b> - Detectors <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label="<b>Module 2</b> - Detectors" data-md-level=1> <label class=md-nav__title for=nav-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> <b>Module 2</b> - Detectors </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../module2/detectors/ title="Working with Detectors" class=md-nav__link> Working with Detectors </a> </li> <li class=md-nav__item> <a href=../../module2/muting/ title="Working with Muting Rules" class=md-nav__link> Working with Muting Rules </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-5 type=checkbox id=nav-5 checked> <label class=md-nav__link for=nav-5> <b>Module 3</b> - Smart Agent <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label="<b>Module 3</b> - Smart Agent" data-md-level=1> <label class=md-nav__title for=nav-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> <b>Module 3</b> - Smart Agent </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../prep/ title=Preparation class=md-nav__link> Preparation </a> </li> <li class=md-nav__item> <a href=../vm/ title="Deploying the Smart Agent on a VM" class=md-nav__link> Deploying the Smart Agent on a VM </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> Deploying the Smart Agent in Kubernetes (K3s) <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M3,9H17V7H3V9M3,13H17V11H3V13M3,17H17V15H3V17M19,17H21V15H19V17M19,7V9H21V7H19M19,13H21V11H19V13Z /></svg> </span> </label> <a href=./ title="Deploying the Smart Agent in Kubernetes (K3s)" class="md-nav__link md-nav__link--active"> Deploying the Smart Agent in Kubernetes (K3s) </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#lab-summary class=md-nav__link> Lab Summary </a> </li> <li class=md-nav__item> <a href=#1-ive-got-the-key-ive-got-the-secret class=md-nav__link> 1. I’ve got the key, I’ve got the secret! </a> </li> <li class=md-nav__item> <a href=#2-take-the-helm class=md-nav__link> 2. Take the Helm! </a> </li> <li class=md-nav__item> <a href=#3-check-all-is-well-in-the-signalfx-ui class=md-nav__link> 3. Check all is well in the SignalFx UI! </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../nginx/ title="Deploying NGINX in K3s" class=md-nav__link> Deploying NGINX in K3s </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6 type=checkbox id=nav-6> <label class=md-nav__link for=nav-6> <b>Module 4</b> - Monitoring as Code <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label="<b>Module 4</b> - Monitoring as Code" data-md-level=1> <label class=md-nav__title for=nav-6> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> <b>Module 4</b> - Monitoring as Code </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../module4/terraform/ title="Using Terraform for charts and dashboards" class=md-nav__link> Using Terraform for charts and dashboards </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-7 type=checkbox id=nav-7> <label class=md-nav__link for=nav-7> <b>Module 5</b> - Service Bureau <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label="<b>Module 5</b> - Service Bureau" data-md-level=1> <label class=md-nav__title for=nav-7> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> <b>Module 5</b> - Service Bureau </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../module5/service_bureau/ title="Billing and Usage" class=md-nav__link> Billing and Usage </a> </li> <li class=md-nav__item> <a href=../../module5/teams/ title=Teams class=md-nav__link> Teams </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-8 type=checkbox id=nav-8> <label class=md-nav__link for=nav-8> <b>Module 6</b> - µAPM <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label="<b>Module 6</b> - µAPM" data-md-level=1> <label class=md-nav__title for=nav-8> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> <b>Module 6</b> - µAPM </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../module6/ title="µAPM Architecture Overview" class=md-nav__link> µAPM Architecture Overview </a> </li> <li class=md-nav__item> <a href=../../module6/hotrod/ title="Deploying Hot R.O.D. in K3s" class=md-nav__link> Deploying Hot R.O.D. in K3s </a> </li> <li class=md-nav__item> <a href=../../module6/sockshop/ title="Deploying Sock Shop in K3s" class=md-nav__link> Deploying Sock Shop in K3s </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-9 type=checkbox id=nav-9> <label class=md-nav__link for=nav-9> <b>Module 7</b> - VictorOps <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label="<b>Module 7</b> - VictorOps" data-md-level=1> <label class=md-nav__title for=nav-9> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> <b>Module 7</b> - VictorOps </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../module7/vo_getting_started/ title="VictorOps Getting Started" class=md-nav__link> VictorOps Getting Started </a> </li> <li class=md-nav__item> <a href=../../module7/integrations/ title="VictorOps Integrations" class=md-nav__link> VictorOps Integrations </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../module-support/cleanup/ title="Post Workshop Clean Up!" class=md-nav__link> <b>Post Workshop Clean Up!</b> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-11 type=checkbox id=nav-11> <label class=md-nav__link for=nav-11> <b>Optional Modules</b> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z /></svg> </span> </label> <nav class=md-nav aria-label="<b>Optional Modules</b>" data-md-level=1> <label class=md-nav__title for=nav-11> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> <b>Optional Modules</b> </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../module8/hotrod-eks/ title="Deploying Hot R.O.D. in EKS" class=md-nav__link> Deploying Hot R.O.D. in EKS </a> </li> <li class=md-nav__item> <a href=../../module-support/ec2-setup/ title="Creating an AWS/EC2 instance" class=md-nav__link> Creating an AWS/EC2 instance </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#lab-summary class=md-nav__link> Lab Summary </a> </li> <li class=md-nav__item> <a href=#1-ive-got-the-key-ive-got-the-secret class=md-nav__link> 1. I’ve got the key, I’ve got the secret! </a> </li> <li class=md-nav__item> <a href=#2-take-the-helm class=md-nav__link> 2. Take the Helm! </a> </li> <li class=md-nav__item> <a href=#3-check-all-is-well-in-the-signalfx-ui class=md-nav__link> 3. Check all is well in the SignalFx UI! </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/signalfx/app-dev-workshop/edit/master/docs/module3/k3s.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"/></svg> </a> <h1>Deploying the Smart Agent in Kubernetes (K3s)</h1> <h3 id=lab-summary>Lab Summary<a class=headerlink href=#lab-summary title="Permanent link">&para;</a></h3> <ul> <li>Use the SignalFx Helm chart to install the Smart Agent in K3s.</li> <li>Explore Your cluster in the Kubernetes Navigator</li> </ul> <p>If you have chosen to run the workshop on a AWS/EC2 instance, please follow instructions given to connect and run the Workshop as described, however skip the Multipass commands in the next section.</p> <hr> <h3 id=1-ive-got-the-key-ive-got-the-secret>1. I’ve got the key, I’ve got the secret!<a class=headerlink href=#1-ive-got-the-key-ive-got-the-secret title="Permanent link">&para;</a></h3> <p>You will need to obtain your Access Token from the SignalFx UI once Kubernetes is running. You can find your Access Token by clicking on your profile icon on the top right of the SignalFx UI. Then select <em><strong>Organisation Settings → Access Tokens</strong></em>. Expand the Default token, then click on <em><strong>Show Token</strong></em> to expose your token. Later in the lab you can come back here and click the <em><strong>Copy</strong></em> button which will copy it to your clipboard so you can paste it when you need to provide an access token in the lab. <img alt="Access Token" src=../../images/module3/m1-l4-access-token.png></p> <p>You will also need to obtain the name of the Realm for your SignalFx account. Click on the profile icon again, but this time select 'My Profile'. The Ream can be found in the middle of the page within the Organizations section. In this example it is <code>us1</code>. <img alt=Realm src=../../images/module3/m1-l4-realm.png></p> <hr> <h3 id=2-take-the-helm>2. Take the Helm!<a class=headerlink href=#2-take-the-helm title="Permanent link">&para;</a></h3> <p>Create the following variables to use in the proceeding helm install command:</p> <div class=tabbed-set data-tabs=1:1><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><label for=__tabbed_1_1>Input</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>export ACCESS_TOKEN=&lt;token from Step 2&gt;
export REALM=&lt;realm from Step 2&gt;
export INITIALS=&lt;your initials e.g. RWC&gt;
export VERSION=&lt;Smart Agent version e.g. 5.1.1&gt;
</code></pre></div> </div> </div> <div class="admonition note"> <p class=admonition-title>Note</p> <p>The latest version of the Smart Agent can be found on <a href=https://github.com/signalfx/signalfx-agent/releases>GitHub</a></p> </div> <p>Install the agent using the SignalFx Helm chart. Firstly, add the SignalFx Helm chart repository to Helm.</p> <div class=tabbed-set data-tabs=2:1><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><label for=__tabbed_2_1>Input</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>helm repo add signalfx https://dl.signalfx.com/helm-repo
</code></pre></div> </div> </div> <p>Ensure the latest state of the SignalFx Helm repository</p> <div class=tabbed-set data-tabs=3:1><input checked=checked id=__tabbed_3_1 name=__tabbed_3 type=radio><label for=__tabbed_3_1>Input</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>helm repo update
</code></pre></div> </div> </div> <p>Install the Smart Agent Helmchart with the following commands:</p> <div class=tabbed-set data-tabs=4:1><input checked=checked id=__tabbed_4_1 name=__tabbed_4 type=radio><label for=__tabbed_4_1>Input</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>sed -i -e &#39;s/\[INITIALS\]/&#39;&quot;$INITIALS&quot;&#39;/&#39; ~/workshop/k3s/values.yaml
helm install \
--set signalFxAccessToken=$ACCESS_TOKEN \
--set clusterName=$INITIALS-SFX-WORKSHOP \
--set kubeletAPI.url=https://localhost:10250  \
--set signalFxRealm=$REALM  \
--set agentVersion=$VERSION \
--set traceEndpointUrl=https://ingest.$REALM.signalfx.com/v2/trace \
--set gatherDockerMetrics=false \
signalfx-agent signalfx/signalfx-agent \
-f ~/workshop/k3s/values.yaml
</code></pre></div> </div> </div> <p>You can monitor the progress of the deployment by running <code>kubectl get pods</code> which should typically report a new pod is up and running after about 30 seconds. Ensure the status is reported as Running before continuing.</p> <div class=tabbed-set data-tabs=5:2><input checked=checked id=__tabbed_5_1 name=__tabbed_5 type=radio><label for=__tabbed_5_1>Input</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>kubectl get pods
</code></pre></div> </div> <input id=__tabbed_5_2 name=__tabbed_5 type=radio><label for=__tabbed_5_2>Output</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>NAME                   READY   STATUS    RESTARTS   AGE
signalfx-agent-66tvr   1/1     Running   0          7s
</code></pre></div> </div> </div> <p>Ensure there are no errors by tailing the logs from the Smart Agent Pod. Output should look similar to the log output shown below. Use the label set by the <code>helm</code> install to tail logs (You will need to press Ctrl-C to exit). Or use the installed <code>k9s</code> terminal UI for bonus points!</p> <div class=tabbed-set data-tabs=6:2><input checked=checked id=__tabbed_6_1 name=__tabbed_6 type=radio><label for=__tabbed_6_1>Input</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>kubectl logs -l <span class=nv>app</span><span class=o>=</span>signalfx-agent -f
</code></pre></div> </div> <input id=__tabbed_6_2 name=__tabbed_6 type=radio><label for=__tabbed_6_2>Output</label><div class=tabbed-content> <div class=highlight><pre><span></span><code>time=&quot;2020-03-15T11:30:28Z&quot; level=info msg=&quot;Starting up agent version 5.0.0&quot;
time=&quot;2020-03-15T11:30:28Z&quot; level=info msg=&quot;Watching for config file changes&quot;
time=&quot;2020-03-15T11:30:28Z&quot; level=info msg=&quot;New config loaded&quot;
time=&quot;2020-03-15T11:30:28Z&quot; level=info msg=&quot;Using log level info&quot;
time=&quot;2020-03-15T11:30:28Z&quot; level=info msg=&quot;Fetching host id dimensions&quot;
time=&quot;2020-03-15T11:30:28Z&quot; level=info msg=&quot;Trying to get fully qualified hostname&quot;
time=&quot;2020-03-15T11:30:28Z&quot; level=info msg=&quot;Using hostname PH-k3s&quot;
time=&quot;2020-03-15T11:30:29Z&quot; level=info msg=&quot;Using host id dimensions map[host:PH-k3s    kubernetes_node_uid:05ba9d7b-89d4-4c70-a3e9-4dc72923423a]&quot;
time=&quot;2020-03-15T11:30:29Z&quot; level=info msg=&quot;Sending datapoints to https://ingest.us1.signalfx.com/v2/datapoint&quot;
time=&quot;2020-03-15T11:30:29Z&quot; level=info msg=&quot;Sending events to https://ingest.us1.signalfx.com/v2/event&quot;
time=&quot;2020-03-15T11:30:29Z&quot; level=info msg=&quot;Creating new monitor&quot; discoveryRule= monitorID=10 monitorType=kubelet-stats
time=&quot;2020-03-15T11:30:29Z&quot; level=info msg=&quot;Creating new monitor&quot; discoveryRule= monitorID=11 monitorType=kubernetes-cluster
time=&quot;2020-03-15T11:30:29Z&quot; level=info msg=&quot;Done configuring agent&quot;
...
time=&quot;2020-03-15T11:30:29Z&quot; level=info msg=&quot;Serving internal metrics at localhost:8095&quot;
    I0315 11:30:29.922577       1 leaderelection.go:242] attempting to acquire leader lease  default/signalfx-agent-leader...
    I0315 11:30:29.950448       1 leaderelection.go:252] successfully acquired lease default/signalfx-agent-leader
time=&quot;2020-03-15T11:30:29Z&quot; level=info msg=&quot;K8s leader is now node ph-k3s&quot;
time=&quot;2020-03-15T11:30:29Z&quot; level=info msg=&quot;Starting K8s API resource sync&quot;
...
</code></pre></div> </div> </div> <hr> <h3 id=3-check-all-is-well-in-the-signalfx-ui>3. Check all is well in the SignalFx UI!<a class=headerlink href=#3-check-all-is-well-in-the-signalfx-ui title="Permanent link">&para;</a></h3> <p>In the SignalFx UI, goto <em><strong>INFRASTRUCTURE → Kubernetes Navigator → Cluster Map</strong></em> and open the Kubernetes Navigator Cluster Map to ensure metrics are being sent.</p> <p><img alt="Selecting the Kubernetes Navigator Map" src=../../images/module3/clustermap-nav.png></p> <hr> <p>Validate that your cluster is discovered and shown (In a workshop you can see many more clusters) by finding your cluster by searching for <code>{YOUR_INITIALS}-SFX-WORKSHOP</code>:</p> <p><img alt="Find Your Cluster" src=../../images/module3/M3-l1-find-cluster.png></p> <p>If there are many clusters you can use the dashboard filter to narrow down to your Kubernetes cluster e.g. <code>kubernetes_cluster: {YOUR_INITIALS}-SFX-WORKSHOP</code> or do this by after selecting your cluster with your mouse.</p> <p><img alt="K8S Clusters Filter" src=../../images/module3/M3-l1-selecting-k3-cluster.png></p> <p>To examine the health of your node, first click on the blue cross <img alt="blue cross" src=../../images/module3/M3-l1-blue-cross.png> when selecting your cluster. This will drill down to the node level. Next, open the side bar by clicking on the side bar button to open the Metrics side bar. Once it is open, you can use the slider on the side to explore the various charts relevant to your cluster/node: Cpu%, Mem%, Network in &amp; out, Events and Container list etc. etc. </p> <p><img alt="Sidebar metrics" src=../../images/module3/M3-l1-explore-metrics.png></p> <p>Take some time to explore the Kubernetes Navigator UI.</p> <hr> <p>Use the <strong>Next</strong> link in the footer below to continue the workshop</p> <hr> <div class=md-source-date> <small> Last update: April 20, 2020 11:28:50 </small> </div> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label=Footer> <a href=../vm/ title="Deploying the Smart Agent on a VM" class="md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z /></svg> </div> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Previous </span> Deploying the Smart Agent on a VM </div> </div> </a> <a href=../nginx/ title="Deploying NGINX in K3s" class="md-footer-nav__link md-footer-nav__link--next" rel=next> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Next </span> Deploying NGINX in K3s </div> </div> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d=M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z /></svg> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2020 Splunk Inc. All rights reserved. </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/vendor.c51dfa35.min.js></script> <script src=../../assets/javascripts/bundle.eaaa3931.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script> <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.58d22e8e.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>