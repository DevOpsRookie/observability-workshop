<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="This workshop is going to take you through the exciting journey of App Dev, what this is, why this is important, and how to get started right away!"><link href=https://signalfx.github.io/app-dev-workshop/archive/apm2/ rel=canonical><meta name=author content="Sales Engineering"><link rel="shortcut icon" href=../../images/favicon.ico><meta name=generator content="mkdocs-1.1, mkdocs-material-5.1.4"><title>µAPM Workshop on K8S - Splunk App Dev Workshop</title><link rel=stylesheet href=../../assets/stylesheets/main.c4007cdc.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.8435c73a.min.css><meta name=theme-color content><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style><link rel=stylesheet href=../../extra.css></head> <body dir=ltr data-md-color-primary=black data-md-color-accent> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#apm-workshop-on-k8s class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=https://signalfx.github.io/app-dev-workshop/ title="Splunk App Dev Workshop" class="md-header-nav__button md-logo" aria-label="Splunk App Dev Workshop"> <img src=../../images/logo.png alt=logo> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <span class="md-header-nav__topic md-ellipsis"> Splunk App Dev Workshop </span> <span class="md-header-nav__topic md-ellipsis"> µAPM Workshop on K8S </span> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class="md-tabs__link md-tabs__link--active"> Home </a> </li> <li class=md-tabs__item> <a href=../../module1/intro/ class=md-tabs__link> <b>SignalFx</b> </a> </li> <li class=md-tabs__item> <a href=../../module7/vo_getting_started/ class=md-tabs__link> <b>VictorOps</b> </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=https://signalfx.github.io/app-dev-workshop/ title="Splunk App Dev Workshop" class="md-nav__button md-logo" aria-label="Splunk App Dev Workshop"> <img src=../../images/logo.png alt=logo> </a> Splunk App Dev Workshop </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title=Home class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2 type=checkbox id=nav-2> <label class=md-nav__link for=nav-2> <b>SignalFx</b> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="<b>SignalFx</b>" data-md-level=1> <label class=md-nav__title for=nav-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> <b>SignalFx</b> </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2-1 type=checkbox id=nav-2-1> <label class=md-nav__link for=nav-2-1> <b>Dashboards</b> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="<b>Dashboards</b>" data-md-level=2> <label class=md-nav__title for=nav-2-1> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> <b>Dashboards</b> </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../module1/intro/ title=Introduction class=md-nav__link> Introduction </a> </li> <li class=md-nav__item> <a href=../../module1/editing/ title="Editing Charts" class=md-nav__link> Editing Charts </a> </li> <li class=md-nav__item> <a href=../../module1/filtering/ title="Using filters" class=md-nav__link> Using filters </a> </li> <li class=md-nav__item> <a href=../../module1/formulas/ title="Using formulas" class=md-nav__link> Using formulas </a> </li> <li class=md-nav__item> <a href=../../module1/overlay/ title="Using overlays" class=md-nav__link> Using overlays </a> </li> <li class=md-nav__item> <a href=../../module1/signalflow/ title=SignalFlow class=md-nav__link> SignalFlow </a> </li> <li class=md-nav__item> <a href=../../module1/adding-charts/ title="Adding charts" class=md-nav__link> Adding charts </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2-2 type=checkbox id=nav-2-2> <label class=md-nav__link for=nav-2-2> <b>Detectors</b> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="<b>Detectors</b>" data-md-level=2> <label class=md-nav__title for=nav-2-2> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> <b>Detectors</b> </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../module2/detectors/ title="Working with Detectors" class=md-nav__link> Working with Detectors </a> </li> <li class=md-nav__item> <a href=../../module2/muting/ title="Working with Muting Rules" class=md-nav__link> Working with Muting Rules </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2-3 type=checkbox id=nav-2-3> <label class=md-nav__link for=nav-2-3> <b>Service Bureau</b> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="<b>Service Bureau</b>" data-md-level=2> <label class=md-nav__title for=nav-2-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> <b>Service Bureau</b> </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../module3/service_bureau/ title="Billing and Usage" class=md-nav__link> Billing and Usage </a> </li> <li class=md-nav__item> <a href=../../module3/teams/ title=Teams class=md-nav__link> Teams </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2-4 type=checkbox id=nav-2-4> <label class=md-nav__link for=nav-2-4> <b>Smart Agent</b> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="<b>Smart Agent</b>" data-md-level=2> <label class=md-nav__title for=nav-2-4> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> <b>Smart Agent</b> </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../module4/prep/ title=Preparation class=md-nav__link> Preparation </a> </li> <li class=md-nav__item> <a href=../../module4/k3s/ title="Deploy the Smart Agent in K3s" class=md-nav__link> Deploy the Smart Agent in K3s </a> </li> <li class=md-nav__item> <a href=../../module4/nginx/ title="Deploy NGINX in K3s" class=md-nav__link> Deploy NGINX in K3s </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2-5 type=checkbox id=nav-2-5> <label class=md-nav__link for=nav-2-5> <b>Monitoring as Code</b> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="<b>Monitoring as Code</b>" data-md-level=2> <label class=md-nav__title for=nav-2-5> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> <b>Monitoring as Code</b> </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../module5/terraform/ title="Using Terraform for charts and dashboards" class=md-nav__link> Using Terraform for charts and dashboards </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2-6 type=checkbox id=nav-2-6> <label class=md-nav__link for=nav-2-6> <b>µAPM</b> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="<b>µAPM</b>" data-md-level=2> <label class=md-nav__title for=nav-2-6> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> <b>µAPM</b> </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../module6/ title="µAPM Architecture Overview" class=md-nav__link> µAPM Architecture Overview </a> </li> <li class=md-nav__item> <a href=../../module6/hotrod/ title="Deploying Hot R.O.D. in K3s" class=md-nav__link> Deploying Hot R.O.D. in K3s </a> </li> <li class=md-nav__item> <a href=../../module6/sockshop/ title="Deploying Sock Shop in K3s" class=md-nav__link> Deploying Sock Shop in K3s </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../module-support/cleanup/ title="Post Workshop Clean Up" class=md-nav__link> <b>Post Workshop Clean Up</b> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-2-8 type=checkbox id=nav-2-8> <label class=md-nav__link for=nav-2-8> <b>Optional Modules</b> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="<b>Optional Modules</b>" data-md-level=2> <label class=md-nav__title for=nav-2-8> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> <b>Optional Modules</b> </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../module-support/hotrod-eks/ title="Deploying Hot R.O.D. in EKS" class=md-nav__link> Deploying Hot R.O.D. in EKS </a> </li> <li class=md-nav__item> <a href=../../module-support/vm/ title="Deploy Smart Agent on a VM" class=md-nav__link> Deploy Smart Agent on a VM </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> <b>VictorOps</b> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg> </span> </label> <nav class=md-nav aria-label="<b>VictorOps</b>" data-md-level=1> <label class=md-nav__title for=nav-3> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> <b>VictorOps</b> </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../module7/vo_getting_started/ title="Getting Started" class=md-nav__link> Getting Started </a> </li> <li class=md-nav__item> <a href=../../module7/vo_integrations/ title=Integrations class=md-nav__link> Integrations </a> </li> <li class=md-nav__item> <a href=../../module7/vo_incident_lifecycle/ title="Incident Lifecycle" class=md-nav__link> Incident Lifecycle </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#step-1-explore-the-sample-nodejs-app class=md-nav__link> Step 1: Explore the sample Node.js app </a> </li> <li class=md-nav__item> <a href=#step-2-instrument-the-nodejs-app class=md-nav__link> Step 2: Instrument the Node.js app </a> </li> <li class=md-nav__item> <a href=#step-3-build-the-docker-image-for-the-nodejs-app class=md-nav__link> Step 3: Build the Docker image for the Node.js app </a> </li> <li class=md-nav__item> <a href=#step-4-deploy-the-nodejs-app-on-k8s class=md-nav__link> Step 4: Deploy the Node.js app on K8S </a> </li> <li class=md-nav__item> <a href=#step-5-test-the-running-nodejs-app class=md-nav__link> Step 5: Test the running Node.js app </a> </li> <li class=md-nav__item> <a href=#step-6-explore-the-sample-python-app class=md-nav__link> Step 6: Explore the sample python app </a> </li> <li class=md-nav__item> <a href=#step-7-instrument-the-python-app class=md-nav__link> Step 7: Instrument the python app </a> </li> <li class=md-nav__item> <a href=#step-8-build-the-docker-image-for-the-python-app class=md-nav__link> Step 8: Build the Docker image for the Python app </a> </li> <li class=md-nav__item> <a href=#step-9-deploy-the-python-app-on-k8s class=md-nav__link> Step 9: Deploy the Python app on K8S </a> </li> <li class=md-nav__item> <a href=#step-10-test-the-running-python-app class=md-nav__link> Step 10: Test the running Python app </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1 id=apm-workshop-on-k8s>µAPM Workshop on K8S<a class=headerlink href=#apm-workshop-on-k8s title="Permanent link">&para;</a></h1> <p>In this module we will instrument a Node.js and a Python application that run on Kubernetes.</p> <h2 id=step-1-explore-the-sample-nodejs-app>Step 1: Explore the sample Node.js app<a class=headerlink href=#step-1-explore-the-sample-nodejs-app title="Permanent link">&para;</a></h2> <p>We are using a slightly modified version of <a href=https://github.com/learnk8s/knote-js/tree/master/04-05>knote</a> from a <a href=https://learnk8s.io/nodejs-kubernetes-guide>Node.js on K8S Tutorial</a>. It is located in the <code>apm/js</code> directory. The app itself is in <code>app/index.js</code>. It also has configuration for running on kubernetes in the folder <code>k8s</code> and a <code>Dockerfile</code> for building the image.</p> <h2 id=step-2-instrument-the-nodejs-app>Step 2: Instrument the Node.js app<a class=headerlink href=#step-2-instrument-the-nodejs-app title="Permanent link">&para;</a></h2> <p>The app is instrumented as per our <a href=https://github.com/signalfx/signalfx-nodejs-tracing#usage>Node.js instrumentation guide</a>:</p> <ol> <li> <p><code>Dockerfile</code> installs the required package dependency as part of the docker image build:</p> <div class=highlight><pre><span></span><code>npm i -S signalfx-tracing
</code></pre></div> </li> <li> <p>Sets up the OpenTracing instrumentation in <code>app/index.js</code> before requiring any other packages:</p> <div class=highlight><pre><span></span><code><span class=kr>const</span> <span class=nx>tracer</span> <span class=o>=</span> <span class=nx>require</span><span class=p>(</span><span class=s1>&#39;signalfx-tracing&#39;</span><span class=p>).</span><span class=nx>init</span><span class=p>({</span>
  <span class=nx>service</span><span class=o>:</span> <span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>SIGNALFX_SERVICE_NAME</span> <span class=o>||</span> <span class=s1>&#39;knote-js&#39;</span><span class=p>,</span>
  <span class=nx>url</span><span class=o>:</span> <span class=sb>`</span><span class=si>${</span><span class=nx>process</span><span class=p>.</span><span class=nx>env</span><span class=p>.</span><span class=nx>SIGNALFX_AGENT_HOST</span><span class=si>}</span><span class=sb>:9080/v1/trace`</span>
<span class=p>})</span>
</code></pre></div> </li> <li> <p>Review the K8S configuration in <code>k8s/knote.yaml</code> and observe the environment variables used in <code>index.js</code> are set there.</p> </li> </ol> <h2 id=step-3-build-the-docker-image-for-the-nodejs-app>Step 3: Build the Docker image for the Node.js app<a class=headerlink href=#step-3-build-the-docker-image-for-the-nodejs-app title="Permanent link">&para;</a></h2> <p>The workshop multipass instance comes with a local docker registry running on <code>registry.local:5000</code>. Docker is pre-configured to obtain images from this registry.</p> <ol> <li> <p>Let's build the images for our app:</p> <div class=highlight><pre><span></span><code>docker build . -t registry.local:5000/knote-js:3.0.0
</code></pre></div> </li> <li> <p>Then transfer them to the registry with:</p> <div class=highlight><pre><span></span><code>docker push registry.local:5000/knote-js:3.0.0
</code></pre></div> </li> </ol> <h2 id=step-4-deploy-the-nodejs-app-on-k8s>Step 4: Deploy the Node.js app on K8S<a class=headerlink href=#step-4-deploy-the-nodejs-app-on-k8s title="Permanent link">&para;</a></h2> <ol> <li> <p>From the <code>workshop/apm/js</code> directory, review from <code>k8s/knote.yaml</code> again and replace <code>[INITIALS]</code> with your actual initials.</p> </li> <li> <p>Then apply the configuration:</p> <div class=highlight><pre><span></span><code>kubectl apply -f k8s
</code></pre></div> </li> </ol> <p>Observe as pods are being created:</p> <div class=codehilite><pre><span></span><code>```bash
kubectl get pods -l app=knote --watch
```
</code></pre></div> <ol> <li> <p>When this shows a running pod for knote, interrupt with <code>Ctrl-C</code> and obtain the service ip:</p> <div class=highlight><pre><span></span><code><span class=nv>IP</span><span class=o>=</span><span class=k>$(</span>kc get svc knote -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{.spec.clusterIP}&#39;</span><span class=k>)</span>
<span class=nb>echo</span> <span class=nv>$IP</span>
</code></pre></div> </li> <li> <p>Validate that the app is running:</p> <div class=highlight><pre><span></span><code>curl -L http://<span class=nv>$IP</span>/
</code></pre></div> <p>It should serve some HTML markup similar to:</p> <div class=highlight><pre><span></span><code><span class=p>&lt;</span><span class=nt>html</span><span class=p>&gt;&lt;</span><span class=nt>head</span><span class=p>&gt;&lt;</span><span class=nt>title</span><span class=p>&gt;&lt;/</span><span class=nt>title</span><span class=p>&gt;&lt;</span><span class=nt>link</span> <span class=na>rel</span><span class=o>=</span><span class=s>&quot;stylesheet&quot;</span> <span class=na>href</span><span class=o>=</span><span class=s>&quot;tachyons.min.css&quot;</span><span class=p>/&gt;&lt;/</span><span class=nt>head</span><span class=p>&gt;&lt;</span><span class=nt>body</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;ph3 pt0 pb4 mw7 center sans-serif&quot;</span><span class=p>&gt;&lt;</span><span class=nt>h1</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;f2 mb0&quot;</span><span class=p>&gt;&lt;</span><span class=nt>span</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;gold&quot;</span><span class=p>&gt;</span>k<span class=p>&lt;/</span><span class=nt>span</span><span class=p>&gt;</span>note<span class=p>&lt;/</span><span class=nt>h1</span><span class=p>&gt;&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;f5 mt1 mb4 lh-copy&quot;</span><span class=p>&gt;</span>A simple note-taking app.<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;&lt;</span><span class=nt>form</span> <span class=na>action</span><span class=o>=</span><span class=s>&quot;/note&quot;</span> <span class=na>method</span><span class=o>=</span><span class=s>&quot;POST&quot;</span> <span class=na>enctype</span><span class=o>=</span><span class=s>&quot;multipart/form-data&quot;</span><span class=p>&gt;&lt;</span><span class=nt>ol</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;list pl0&quot;</span><span class=p>&gt;&lt;</span><span class=nt>li</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;mv3&quot;</span><span class=p>&gt;&lt;</span><span class=nt>label</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;f6 b db mb2&quot;</span> <span class=na>for</span><span class=o>=</span><span class=s>&quot;image&quot;</span><span class=p>&gt;</span>Upload an image<span class=p>&lt;/</span><span class=nt>label</span><span class=p>&gt;&lt;</span><span class=nt>input</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;f6 link dim br1 ba b--black-20 ph3 pv2 mb2 dib black bg-white pointer&quot;</span> <span class=na>type</span><span class=o>=</span><span class=s>&quot;file&quot;</span> <span class=na>name</span><span class=o>=</span><span class=s>&quot;image&quot;</span><span class=p>/&gt;&lt;</span><span class=nt>input</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;f6 link dim br1 ba bw1 ph3 pv2 mb2 dib black bg-white pointer ml2&quot;</span> <span class=na>type</span><span class=o>=</span><span class=s>&quot;submit&quot;</span> <span class=na>value</span><span class=o>=</span><span class=s>&quot;Upload&quot;</span> <span class=na>name</span><span class=o>=</span><span class=s>&quot;upload&quot;</span><span class=p>/&gt;&lt;/</span><span class=nt>li</span><span class=p>&gt;&lt;</span><span class=nt>li</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;mv3&quot;</span><span class=p>&gt;&lt;</span><span class=nt>label</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;f6 b db mb2&quot;</span> <span class=na>for</span><span class=o>=</span><span class=s>&quot;description&quot;</span><span class=p>&gt;</span>Write your content here<span class=p>&lt;/</span><span class=nt>label</span><span class=p>&gt;&lt;</span><span class=nt>textarea</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;f4 db border-box hover-black w-100 measure ba b--black-20 pa2 br2 mb2&quot;</span> <span class=na>rows</span><span class=o>=</span><span class=s>&quot;5&quot;</span> <span class=na>name</span><span class=o>=</span><span class=s>&quot;description&quot;</span><span class=p>&gt;&lt;/</span><span class=nt>textarea</span><span class=p>&gt;&lt;</span><span class=nt>input</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;f6 link dim br1 ba bw1 ph3 pv2 mb2 dib black bg-white pointer&quot;</span> <span class=na>type</span><span class=o>=</span><span class=s>&quot;submit&quot;</span> <span class=na>value</span><span class=o>=</span><span class=s>&quot;Publish&quot;</span> <span class=na>name</span><span class=o>=</span><span class=s>&quot;publish&quot;</span><span class=p>/&gt;&lt;/</span><span class=nt>li</span><span class=p>&gt;&lt;/</span><span class=nt>ol</span><span class=p>&gt;&lt;/</span><span class=nt>form</span><span class=p>&gt;&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;lh-copy f6&quot;</span><span class=p>&gt;</span>You don&#39;t have any notes yet.<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;&lt;/</span><span class=nt>body</span><span class=p>&gt;&lt;/</span><span class=nt>html</span><span class=p>&gt;</span>
</code></pre></div> </li> </ol> <h2 id=step-5-test-the-running-nodejs-app>Step 5: Test the running Node.js app<a class=headerlink href=#step-5-test-the-running-nodejs-app title="Permanent link">&para;</a></h2> <ol> <li> <p>This is a simple note taking app, so let's make some notes by adding random words:</p> <div class=highlight><pre><span></span><code><span class=k>for</span> i in <span class=o>{</span><span class=m>1</span>..10<span class=o>}</span><span class=p>;</span> <span class=k>do</span> curl -L -F<span class=s2>&quot;image=&quot;</span> -F<span class=s2>&quot;description=</span><span class=k>$(</span>shuf -n1 /usr/share/dict/words<span class=k>)</span><span class=s2>&quot;</span> http://<span class=nv>$IP</span>/note<span class=p>;</span> <span class=k>done</span>
</code></pre></div> </li> <li> <p>If you curl the app again you should now see a list of notes after the above markup:</p> <div class=highlight><pre><span></span><code>…
<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;&lt;/</span><span class=nt>li</span><span class=p>&gt;&lt;</span><span class=nt>li</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;mv3 bb bw2 b--light-yellow bg-washed-yellow ph4 pv2&quot;</span><span class=p>&gt;&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;measure&quot;</span><span class=p>&gt;&lt;</span><span class=nt>p</span><span class=p>&gt;</span>semiretired<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;&lt;/</span><span class=nt>li</span><span class=p>&gt;&lt;</span><span class=nt>li</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;mv3 bb bw2 b--light-yellow bg-washed-yellow ph4 pv2&quot;</span><span class=p>&gt;&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;measure&quot;</span><span class=p>&gt;&lt;</span><span class=nt>p</span><span class=p>&gt;</span>streakier<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;&lt;/</span><span class=nt>li</span><span class=p>&gt;&lt;</span><span class=nt>li</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;mv3 bb bw2 b--light-yellow bg-washed-yellow ph4 pv2&quot;</span><span class=p>&gt;&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;measure&quot;</span><span class=p>&gt;&lt;</span><span class=nt>p</span><span class=p>&gt;</span>relay<span class=ni>&amp;#39;</span>s<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;&lt;/</span><span class=nt>li</span><span class=p>&gt;&lt;</span><span class=nt>li</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;mv3 bb bw2 b--light-yellow bg-washed-yellow ph4 pv2&quot;</span><span class=p>&gt;&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;measure&quot;</span><span class=p>&gt;&lt;</span><span class=nt>p</span><span class=p>&gt;</span>seconding<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;&lt;/</span><span class=nt>li</span><span class=p>&gt;&lt;</span><span class=nt>li</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;mv3 bb bw2 b--light-yellow bg-washed-yellow ph4 pv2&quot;</span><span class=p>&gt;&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;measure&quot;</span><span class=p>&gt;&lt;</span><span class=nt>p</span><span class=p>&gt;</span>rouged<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;&lt;/</span><span class=nt>li</span><span class=p>&gt;&lt;</span><span class=nt>li</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;mv3 bb bw2 b--light-yellow bg-washed-yellow ph4 pv2&quot;</span><span class=p>&gt;&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;measure&quot;</span><span class=p>&gt;&lt;</span><span class=nt>p</span><span class=p>&gt;</span>pours<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;&lt;/</span><span class=nt>li</span><span class=p>&gt;&lt;</span><span class=nt>li</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;mv3 bb bw2 b--light-yellow bg-washed-yellow ph4 pv2&quot;</span><span class=p>&gt;&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;measure&quot;</span><span class=p>&gt;&lt;</span><span class=nt>p</span><span class=p>&gt;</span>disproof<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;&lt;/</span><span class=nt>li</span><span class=p>&gt;&lt;</span><span class=nt>li</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;mv3 bb bw2 b--light-yellow bg-washed-yellow ph4 pv2&quot;</span><span class=p>&gt;&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;measure&quot;</span><span class=p>&gt;&lt;</span><span class=nt>p</span><span class=p>&gt;</span>exhortation<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;&lt;/</span><span class=nt>li</span><span class=p>&gt;&lt;</span><span class=nt>li</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;mv3 bb bw2 b--light-yellow bg-washed-yellow ph4 pv2&quot;</span><span class=p>&gt;&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;measure&quot;</span><span class=p>&gt;&lt;</span><span class=nt>p</span><span class=p>&gt;</span>sprigs<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;&lt;/</span><span class=nt>li</span><span class=p>&gt;&lt;</span><span class=nt>li</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;mv3 bb bw2 b--light-yellow bg-washed-yellow ph4 pv2&quot;</span><span class=p>&gt;&lt;</span><span class=nt>p</span> <span class=na>class</span><span class=o>=</span><span class=s>&quot;measure&quot;</span><span class=p>&gt;&lt;</span><span class=nt>p</span><span class=p>&gt;</span>tramped<span class=p>&lt;/</span><span class=nt>p</span><span class=p>&gt;</span>
</code></pre></div> </li> <li> <p>Let's simulate load for the app:</p> <div class=highlight><pre><span></span><code>ab -n <span class=m>1000</span> -c <span class=m>20</span> http://<span class=nv>$IP</span>/
</code></pre></div> </li> </ol> <p>At this point you should see traffic in your µAPM view. </p> <h2 id=step-6-explore-the-sample-python-app>Step 6: Explore the sample python app<a class=headerlink href=#step-6-explore-the-sample-python-app title="Permanent link">&para;</a></h2> <h2 id=step-7-instrument-the-python-app>Step 7: Instrument the python app<a class=headerlink href=#step-7-instrument-the-python-app title="Permanent link">&para;</a></h2> <h2 id=step-8-build-the-docker-image-for-the-python-app>Step 8: Build the Docker image for the Python app<a class=headerlink href=#step-8-build-the-docker-image-for-the-python-app title="Permanent link">&para;</a></h2> <h2 id=step-9-deploy-the-python-app-on-k8s>Step 9: Deploy the Python app on K8S<a class=headerlink href=#step-9-deploy-the-python-app-on-k8s title="Permanent link">&para;</a></h2> <h2 id=step-10-test-the-running-python-app>Step 10: Test the running Python app<a class=headerlink href=#step-10-test-the-running-python-app title="Permanent link">&para;</a></h2> <hr> <div class=md-source-date> <small> Last update: April 29, 2020 10:29:56 </small> </div> </article> </div> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2020 Splunk Inc. All rights reserved. </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/vendor.83fe6e3c.min.js></script> <script src=../../assets/javascripts/bundle.7e1cb91c.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script> <script>
        app = initialize({
          base: "../..",
          features: ["tabs"],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.37585f48.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>